<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Mask Runner</title>
  <meta name="theme-color" content="#0b0b0f" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #0b0b0f;
      color: white;
      font-family: system-ui, sans-serif;
      height: 100%;
      touch-action: none;
    }
    canvas {
      display: block;
      margin: auto;
      background: #111;
    }
    #ui {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div id="ui">Score: <span id="score">0</span></div>
  <canvas id="game" width="360" height="640"></canvas>
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const TILE = 40, WIDTH = 9, HEIGHT = 16;
    let score = 0;
    let player = { x: 4, y: 14, dx: 0, dy: 0, alive: true };
    let map = [];
    function generateRow() { let row = '#'; for (let i=1;i<WIDTH-1;i++){const r=Math.random(); if(r<0.1) row+='^'; else if(r<0.25) row+='#'; else row+='.';} row+='#'; return row; }
    function initMap() { map=[]; for(let i=0;i<HEIGHT;i++) map.push('#########'); map[HEIGHT-2]='#.......#'; }
    function updateMap() { if(player.y<HEIGHT/2){map.pop(); map.unshift(generateRow()); player.y++; score++;}}
    function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height); for(let y=0;y<map.length;y++){for(let x=0;x<map[y].length;x++){const t=map[y][x]; if(t==='#'){ctx.fillStyle='#2ecc71'; ctx.fillRect(x*TILE,y*TILE,TILE,TILE);} if(t==='^'){ctx.fillStyle='#e74c3c'; ctx.beginPath(); ctx.moveTo(x*TILE+TILE/2,y*TILE+5); ctx.lineTo(x*TILE+5,y*TILE+TILE-5); ctx.lineTo(x*TILE+TILE-5,y*TILE+TILE-5); ctx.fill();}}} if(player.alive){ctx.fillStyle='#f1c40f'; ctx.beginPath(); ctx.arc(player.x*TILE+TILE/2,player.y*TILE+TILE/2,TILE/2.5,0,Math.PI*2); ctx.fill();}}
    function update(){ if(!player.alive) return; if(player.dx||player.dy){let nx=player.x+player.dx; let ny=player.y+player.dy; while(map[ny]&&map[ny][nx]==='.'){player.x=nx; player.y=ny; nx+=player.dx; ny+=player.dy;} if(map[ny]&&map[ny][nx]==='^'){alert('Game Over! Score: '+score); reset();} player.dx=0; player.dy=0;} updateMap();}
    function reset(){score=0; player={x:4,y:14,dx:0,dy:0,alive:true}; initMap();}
    function loop(){update(); draw(); document.getElementById('score').textContent=score; requestAnimationFrame(loop);}
    function move(dx,dy){player.dx=dx; player.dy=dy;}
    let sx, sy; canvas.addEventListener('touchstart',e=>{sx=e.touches[0].clientX; sy=e.touches[0].clientY;});
    canvas.addEventListener('touchend',e=>{const dx=e.changedTouches[0].clientX-sx; const dy=e.changedTouches[0].clientY-sy; if(Math.abs(dx)>Math.abs(dy)) move(Math.sign(dx),0); else move(0,Math.sign(dy));});
    window.addEventListener('keydown',e=>{if(e.key==='ArrowUp') move(0,-1); if(e.key==='ArrowDown') move(0,1); if(e.key==='ArrowLeft') move(-1,0); if(e.key==='ArrowRight') move(1,0);});
    initMap(); loop();
  </script>
</body>
</html>
